# 라우팅, 라우터, 게이트웨이
## 라우팅
라우팅이란? 네트워크에서 미리 정해진 규칙을 사용하여 최상의 경로를 선택하는 프로세스이다. 
노드들이 링크로 연결되어져 데이터를 전송하는 컴퓨터 네트워크에서 두 노드간의 통신은 여러 경로를 통해 이루어질 수 있다.
네트워크가 정체 없이 최대한 많은 용량을 사용할 수 있도록 데이터 트래픽을 관리함으로써, 네트워크 장애를 최소화해준다.

## 라우팅의 동작과정
[네트워크 기초](https://github.com/hoeun0723/TIL/blob/main/network/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC%20%EA%B8%B0%EC%B4%88/README.md)에서 설명했듯이, 데이터는 데이터 패킷의 형태로 네트워크를 통해 이동하는데, 각 데이터 패킷에는 패킷의 의도된 대상에 대한 정보가 포함된 헤더가 있다. 패킷이 대상으로 이동하는 동안 여러 라우터가 패킷을 여러 번 라우팅 할 수 있고, 라우터는 수백만 개의 패킷에 대해 초당 수 백만번 이 프로세스를 수행한다.
데이터 패킷이 도착하면 라우터는 먼저 라우팅 테이블에서 그 주소를 찾는다. 이는 목적지까지 가는 데 가장 적합한 버스 노선을 찾기 위해 버스 시간표를 참조하는 승객에 비유할 수 있다.
이후 라우터는 패킷을 네트워크의 다음 지점으로 전달하거나 이동한다. 예를 들어 사무실 네트워크의 컴퓨터에서 웹 사이트를 방문하면, 데이터 패킷이 먼저 사무실 네트워크 라우터로 이동한다. 라우터가 헤더 패킷을 조회하고 패킷 대상을 결정한다. 그런 다음 내부 테이블을 조회하고, 네트워크 자체 내에서 패킷을 다음 라우터로 전달하거나 프린터와 같은 다른 디바이스로 전달한다.
<img src="https://github.com/user-attachments/assets/906f22bc-5c42-45a4-81a7-45fa62f6c2e3" width="350"/>


## 라우터
그렇다면 라우터는 무엇일까? 라우터는 컴퓨팅 디바이스와 네트워크를 다른 네트워크에 연결하는 네트워킹 디바이스이다.
- 경로 결정 : 라우터는 소스에서 대상으로 이동하는 데이터의 경로를 결정. 지연, 용량 및 속도와 같은 네트워크 지표를 분석하여 최상의 경로를 찾으려고 시도함.
- 데이터 전달 : 선택한 경로의 다음 디바이스로 데이터를 전달하여 최종적으로 대상에 도달하도록 함.
- 로드 밸런싱 : 때에 따라 라우터가 여러 경로를 사용하여 동일한 데이터 패킷의 여러 사본을 전송할 수도 있다. 이 방법을 통해 데이터 손실로 인한 오류를 줄이고 이중화를 구현하고 트래픽 볼륨을 관리한다.
라우터는 라우팅 테이블을 기반으로 데이터를 다음 목적지까지 전달한다. 주로 LAN과 WAN을 연결(layer3)하는데 많이 사용한다. OSI 3계층 및 4계층을 이용하곤 한다.

## 라우팅 테이블
라우팅 테이블은 패킷에 있는 주소 정보들을 조회한 후, 그에 따른 위치 를 저장한 테이블이다. 정리해서 IP주소를 기반으로 라우터의 위치를 저장한 테이블 또는 데이터 베이스이다. 다양한 네트워크에 대한 정보와 해당 네트워크에 연결하는 방법이 포함되어있다.

### 라우팅 테이블 구성 요소
- 네트워크 대상(network destination) : 목적지 네트워크 ip 주소
- 서브넷 마스크(netmask) : 대상 주소를 설명할 때 쓰이는 값
- 게이트웨이(gateway) : 해당 장치와 연결된 홉, 패킷이 전달되는 다음 ip주소(외부 네트워크와 연결된 장치)
  - 목적지가 로컬이면 "connected"라고 표기됨
- 인터페이스(interface) : 게이트워이로 가기 위해 거치는 장치
- 메트릭(metric) : 우선순위, 패킷 전송을 위해 최적의 경로가 선택되도록 참고되는 값
  - 동일한 라우팅 테이블 요소가 2개 있을 때 이 값이 낮은 요소가 선택됨

<img src="https://github.com/user-attachments/assets/0bb0ef76-b60a-4425-9526-91f6f5b17986" width="350"/>

 
## 게이트웨이(Gateway)
게이트웨이란 한 네트워크에서 다른 네트워크로 이동하기 위해서 거쳐야 하는 지점이다. 게이트웨이는 네트워크 프로토콜이 다를 경우 중재 역할을 해주며 서로 다른 네트워크(이기종 네트워크)를 연결해준다. 또한 게이트웨이는 OSI 5계층 이상을 이용한다.
게이트웨니는 다른 언어를 사용하는 두 사람 사이의 통역사와 비슷하다고 볼 수 있다. 우측 통행하는 나라에서 좌측통행하는 나라로 이어진 도로가 있다고 했을때, 게이트웨이를 지나면서 바뀐 도로의 규칙(프로토콜)을 알려주고 적용한다.

## 홉(hop)
네트워크에서 출발지와 목적지 사이에 위치한 장치를 의미한다. 홉 카운트(hop count)는 데이터가 출발지와 목적지 사이에서 통과해야하는 홉의 개수를 의미한다.

## 실습
<img width="434" alt="image" src="https://github.com/user-attachments/assets/a8894d39-33f1-4b19-aebf-19428eeb41d3" />
<img width="454" alt="image" src="https://github.com/user-attachments/assets/f853cf77-bb15-4369-8ac2-01cd79bd1ad4" />

https://blog.voidmainvoid.net/201
해당 블로그를 보며 netstat로 네트워크 연결 상태를 살펴보았다. 프로토콜 종류와 출발지 주소 그리고 목적지 주소 마지막으로 state 까지. 확인할 수 있었다.
state는 listen 이 있었고 established(연결 완료) time_wait 등이 있었다. (+closed)
추가적으로 -r 명령어를 통해 라우팅테이블 구조를 확인할 수 있었다.
### netstat(network statistics)
전송 제어 프로토콜, 라우팅 테이블, 수많은 네트워크 인터페이스(네트워크 인터페이스 컨트롤러 또는 소프트웨어 정의 ㅡ네트워크 인터페이스), 네트워크 프로토콜 통계를 위한 네트워크 연결을 보여주는 명령 줄 도구
### netstat 옵션들
- -a : 현재 다른 PC와 연결(Established)되어 있거나 대기(Listening) 중인 모든 포트 번호를 확인
- -r : 라우팅 테이블 확인 및 커넥션 되어 있는 포트 번호를 확인
- -n : 이름이 있는 원격 주소의 레이블을 억제. 제한된 정보만을 희생시키면서 netstat의 출력 속도를 크게 향상
- -e : 랜카드에서 송수한 패킷의 용량 및 종류를 확인
- -s : IP, ICMP, UDP프로토콜별의 상태 확인
- -t : tcp protocol
- -u : udp protocol
- -p : 프로토콜 사용 Process ID 노출
- -c : 1초 단위로 보여줌



### 참고자료
https://aws.amazon.com/ko/what-is/routing/?trk=faq_card
https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/VPC_Route_Tables.html
https://it.donga.com/21138/
